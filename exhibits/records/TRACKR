TRACKR
      SUBROUTINE TRACKR 
C 
C  TRACK MOUSE ON DISPLAY AND INTENSIFY SMALLEST BOX
C  CONTAINING TRACKING SYMBOL.
C 
C  COMMON BLOCK /MOUSE/ 
C 
C     IRF - INDEX OF REFERENCED NODE
C     IFT - INDEX OF FATHER OF IRF, 0 IF NONE 
C     NXP, NYP - MOUSE POSITION IN SCREEN COORDINATES 
C 
*CALL,DATA
*CALL,MOUSE 
      DATA NSTR/0/
      DATA NXS,NYS/0,0/ 
      DATA NDLY/100/
C 
C  STATEMENT FUNCTIONS
C 
      COORD(N)=FLOAT(MIN0(MAX0(N,20),1003))/100.
C 
C  INITIALIZE ON FIRST CALL 
C 
      IF(NSTR.NE.0) GOTO 202
      CALL ALLOC(NSTR)
      CALL CIRCLE(0.,0.,.2,16)
C 
C  COMPUTE MOUSE POSITION WITH DAMPING
C 
202   CALL MOUSE(X,Y) 
      NXP=(4*NXP+MIN0(MAX0(IFIX(100.*X),KXM),KXX))/5
      NYP=(4*NYP+MIN0(MAX0(IFIX(100.*Y),KYM),KYX))/5
      CALL MOVE(NSTR,COORD(NXP),COORD(NYP)) 
C 
C  DISPLAY CURSOR ONLY WHEN NEEDED
C 
302   IF(NXP.NE.NXS) GOTO 304 
      IF(NYP.NE.NYS) GOTO 304 
      IF(ICH.NE.0) GOTO 304 
      IF(NDLY.LT.0) RETURN
      NDLY=NDLY-1 
      IF(NDLY.GE.0) GOTO 306
      CALL BLANK(NSTR)
      RETURN
304   IF(NDLY.LT.0) CALL BLANK(-NSTR) 
      NXS=NXP 
      NYS=NYP 
      NDLY=100
306   CONTINUE
C 
C  SEARCH DATA STRUCTURE FOR ENCLOSING BOX
C 
      IFT=0 
      IPT=IRD 
402   IF(IPT.EQ.0) GOTO 502 
      IF(LSG(IPT).EQ.0) GOTO 502
      IF(NXP.GT.LXX(IPT)) GOTO 406
      IF(NYP.LT.LYM(IPT)) GOTO 408
      IF(NXP.LT.LXM(IPT).OR.NYP.GT.LYX(IPT))GOTO 502
      IFT=IRF 
      IRF=IPT 
      IPT=LSN(IPT)
      GOTO 402
406   IPT=LBT(IPT)
      GOTO 402
408   IPT=LNX(IPT)
      GOTO 402
C 
C  INTENSIFY REFERENCED BOX 
C 
502   CALL BOX(IRF) 
      RETURN
      END 
